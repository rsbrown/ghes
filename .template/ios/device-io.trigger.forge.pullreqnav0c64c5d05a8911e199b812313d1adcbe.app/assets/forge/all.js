/*! Copyright 2011 Trigger Corp. All rights reserved. */
(function(){var n={};n.config={browser_action:{default_popup:"index.html",default_icon:"img/dobbs.jpg"},version:"0.3",logging:{level:"INFO"},name:"pullreqnav",uuid:"0c64c5d05a8911e199b812313d1adcbe"};var o={};o.listeners={};var q={};var h=[];var g=null;var a=false;var s=function(){if(h.length>0){if(!window.forge.debug||window.catalystConnected){a=true;while(h.length>0){var t=h.shift();if(t[0]=="logging.log"){console.log(t[1].message)}o.priv.call.apply(o.priv,t)}a=false}else{g=setTimeout(s,500)}}};o.priv={call:function(y,x,w,u){if((!window.forge.debug||window.catalystConnected)&&(h.length==0||a)){var t=n.tools.UUID();var v=true;if(y==="button.onClicked.addListener"||y==="message.toFocussed"){v=false}if(w||u){q[t]={success:w,error:u,onetime:v}}o.priv.send({callid:t,method:y,params:x})}else{h.push(arguments);if(!g){g=setTimeout(s,500)}}},send:function(t){throw new Error("Forge error: missing bridge to privileged code")},receive:function(t){if(t.callid){if(typeof q[t.callid]===undefined){n.log("Nothing stored for call ID: "+t.callid)}var v=q[t.callid];var u=(typeof t.content==="undefined"?null:t.content);if(v&&v[t.status]){v[t.status](t.content)}if(v&&v.onetime){delete q[t.callid]}}else{if(t.event){if(o.listeners[t.event]){o.listeners[t.event].forEach(function(w){if(t.params){w(t.params)}else{w()}})}}}}};o.generateQueryString=function(t){if(typeof t==="string"){return t}var u="";for(key in t){u+=encodeURIComponent(key)+"="+encodeURIComponent(t[key])+"&"}return u.substring(0,u.length-1)};o.generateMultipartString=function(t,v){if(typeof t==="string"){return""}var u="";for(key in t){u+="--"+v+"\r\n";u+='Content-Disposition: form-data; name="'+key.replace('"','\\"')+'"\r\n\r\n';u+=t[key].toString()+"\r\n"}return u},o.generateURI=function(u,t){var v="";if(u.indexOf("?")!==-1){v+=u.split("?")[1]+"&";u=u.split("?")[0]}v+=this.generateQueryString(t)+"&";v=v.substring(0,v.length-1);return u+(v?"?"+v:"")};n.is={mobile:function(){return false},desktop:function(){return false},android:function(){return false},ios:function(){return false},chrome:function(){return false},firefox:function(){return false},safari:function(){return false},ie:function(){return false},web:function(){return false}};n.button={setIcon:function(u,v,t){o.priv.call("button.setIcon",u,v,t)},setURL:function(u,v,t){o.priv.call("button.setURL",u,v,t)},onClicked:{addListener:function(t){o.priv.call("button.onClicked.addListener",null,t)}},setBadge:function(u,v,t){o.priv.call("button.setBadge",u,v,t)},setBadgeBackgroundColor:function(u,v,t){o.priv.call("button.setBadgeBackgroundColor",u,v,t)},setTitle:function(v,u,t){o.priv.call("button.setTitle",v,u,t)}};n.message={listen:function(u,v,t){t&&t({message:"Forge Error: message.listen must be overridden by platform specific code",type:"UNAVAILABLE"})},broadcast:function(u,v,w,t){t&&t({message:"Forge Error: message.broadcast must be overridden by platform specific code",type:"UNAVAILABLE"})},broadcastBackground:function(u,v,w,t){t&&t({message:"Forge Error: message.broadcastBackground must be overridden by platform specific code",type:"UNAVAILABLE"})},toFocussed:function(u,v,w,t){o.priv.call("message.toFocussed",{type:u,content:v},w,t)}};n.notification={create:function(w,v,u,t){o.priv.call("notification.create",{title:w,text:v},u,t)}};n.request={get:function(u,v,t){n.request.ajax({url:u,dataType:"text",success:v&&function(){try{arguments[0]=JSON.parse(arguments[0])}catch(w){}v.apply(this,arguments)},error:t})},ajax:function(v){var t=v.dataType;if(t=="xml"){v.dataType="text"}var w=v.success&&function(z){try{if(t=="xml"){var y,x;if(window.DOMParser){y=new DOMParser();x=y.parseFromString(z,"text/xml")}else{x=new ActiveXObject("Microsoft.XMLDOM");x.async="false";x.loadXML(z)}z=x}}catch(A){}v.success&&v.success(z)};var u=v.error&&function(x){if(x.status=="error"&&!x.err){n.logging.log("AJAX request to "+v.url+" failed, have you included that url in the permissions section of the config file for this app?")}v.error&&v.error(x)};o.priv.call("request.ajax",v,w,u)}};n.tools={UUID:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(w){var u=Math.random()*16|0;var t=w=="x"?u:(u&3|8);return t.toString(16)}).toUpperCase()},getURL:function(u,v,t){o.priv.call("tools.getURL",{name:u.toString()},v,t)}};var i=function(z,x,A){var v=[];stylize=function(C,B){return C};function t(B){return B instanceof RegExp||(typeof B==="object"&&Object.prototype.toString.call(B)==="[object RegExp]")}function u(B){return B instanceof Array||Array.isArray(B)||(B&&B!==Object.prototype&&u(B.__proto__))}function w(D){if(D instanceof Date){return true}if(typeof D!=="object"){return false}var B=Date.prototype&&Object.getOwnPropertyNames(Date.prototype);var C=D.__proto__&&Object.getOwnPropertyNames(D.__proto__);return JSON.stringify(C)===JSON.stringify(B)}function y(N,K){try{if(N&&typeof N.inspect==="function"&&!(N.constructor&&N.constructor.prototype===N)){return N.inspect(K)}switch(typeof N){case"undefined":return stylize("undefined","undefined");case"string":var B="'"+JSON.stringify(N).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return stylize(B,"string");case"number":return stylize(""+N,"number");case"boolean":return stylize(""+N,"boolean")}if(N===null){return stylize("null","null")}if(N instanceof Document){return(new XMLSerializer()).serializeToString(N)}var H=Object.keys(N);var O=x?Object.getOwnPropertyNames(N):H;if(typeof N==="function"&&O.length===0){var C=N.name?": "+N.name:"";return stylize("[Function"+C+"]","special")}if(t(N)&&O.length===0){return stylize(""+N,"regexp")}if(w(N)&&O.length===0){return stylize(N.toUTCString(),"date")}var D,L,I;if(u(N)){L="Array";I=["[","]"]}else{L="Object";I=["{","}"]}if(typeof N==="function"){var G=N.name?": "+N.name:"";D=" [Function"+G+"]"}else{D=""}if(t(N)){D=" "+N}if(w(N)){D=" "+N.toUTCString()}if(O.length===0){return I[0]+D+I[1]}if(K<0){if(t(N)){return stylize(""+N,"regexp")}else{return stylize("[Object]","special")}}v.push(N);var F=O.map(function(Q){var P,R;if(N.__lookupGetter__){if(N.__lookupGetter__(Q)){if(N.__lookupSetter__(Q)){R=stylize("[Getter/Setter]","special")}else{R=stylize("[Getter]","special")}}else{if(N.__lookupSetter__(Q)){R=stylize("[Setter]","special")}}}if(H.indexOf(Q)<0){P="["+Q+"]"}if(!R){if(v.indexOf(N[Q])<0){if(K===null){R=y(N[Q])}else{R=y(N[Q],K-1)}if(R.indexOf("\n")>-1){if(u(N)){R=R.split("\n").map(function(S){return"  "+S}).join("\n").substr(2)}else{R="\n"+R.split("\n").map(function(S){return"   "+S}).join("\n")}}}else{R=stylize("[Circular]","special")}}if(typeof P==="undefined"){if(L==="Array"&&Q.match(/^\d+$/)){return R}P=JSON.stringify(""+Q);if(P.match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)){P=P.substr(1,P.length-2);P=stylize(P,"name")}else{P=P.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'");P=stylize(P,"string")}}return P+": "+R});v.pop();var M=0;var E=F.reduce(function(P,Q){M++;if(Q.indexOf("\n")>=0){M++}return P+Q.length+1},0);if(E>50){F=I[0]+(D===""?"":D+"\n ")+" "+F.join(",\n  ")+" "+I[1]}else{F=I[0]+D+" "+F.join(", ")+" "+I[1]}return F}catch(J){return"[No string representation]"}}return y(z,(typeof A==="undefined"?2:A))};var b=function(u,v){if("logging" in n.config){var t=n.config.logging.marker||"FORGE"}else{var t="FORGE"}u="["+t+"] "+(u.indexOf("\n")===-1?"":"\n")+u;o.priv.call("logging.log",{message:u,level:v});if(typeof console!=="undefined"){switch(v){case 10:if(console.debug!==undefined&&!(console.debug.toString&&console.debug.toString().match("alert"))){console.debug(u)}break;case 30:if(console.warn!==undefined&&!(console.warn.toString&&console.warn.toString().match("alert"))){console.warn(u)}break;case 40:case 50:if(console.error!==undefined&&!(console.error.toString&&console.error.toString().match("alert"))){console.error(u)}break;default:case 20:if(console.info!==undefined&&!(console.info.toString&&console.info.toString().match("alert"))){console.info(u)}break}}};var m=function(t,u){if(t in n.logging.LEVELS){return n.logging.LEVELS[t]}else{n.logging.__logMessage("Unknown configured logging level: "+t);return u}};var r=function(u){var x=function(y){if(y.message){return y.message}else{if(y.description){return y.description}else{return""+y}}};if(u){var w="\nError: "+x(u);try{if(u.lineNumber){w+=" on line number "+u.lineNumber}if(u.fileName){var t=u.fileName;w+=" in file "+t.substr(t.lastIndexOf("/")+1)}}catch(v){}if(u.stack){w+="\r\nStack trace:\r\n"+u.stack}return w}return""};n.logging={LEVELS:{ALL:0,DEBUG:10,INFO:20,WARNING:30,ERROR:40,CRITICAL:50},debug:function(u,t){n.logging.log(u,t,n.logging.LEVELS.DEBUG)},info:function(u,t){n.logging.log(u,t,n.logging.LEVELS.INFO)},warning:function(u,t){n.logging.log(u,t,n.logging.LEVELS.WARNING)},error:function(u,t){n.logging.log(u,t,n.logging.LEVELS.ERROR)},critical:function(u,t){n.logging.log(u,t,n.logging.LEVELS.CRITICAL)},log:function(u,t,x){if(typeof(x)==="undefined"){var x=n.logging.LEVELS.INFO}try{var v=m(n.config.logging.level,n.logging.LEVELS.ALL)}catch(w){var v=n.logging.LEVELS.ALL}if(x>=v){b(i(u)+r(t),x)}}};var l=function(x){if(x=="<all_urls>"){x="*://*"}x=x.split("://");var t=x[0];var v,w;if(x[1].indexOf("/")===-1){v=x[1];w=""}else{v=x[1].substring(0,x[1].indexOf("/"));w=x[1].substring(x[1].indexOf("/"))}var u="";if(t=="*"){u+=".*://"}else{u+=t+"://"}if(v=="*"){u+=".*"}else{if(v.indexOf("*.")===0){u+="(.+.)?"+v.substring(2)}else{u+=v}}u+=w.replace(/\*/g,".*");return"^"+u+"$"};n.tabs={open:function(u,v,w,t){if(typeof v==="function"){t=w;w=v;v=false}o.priv.call("tabs.open",{url:u,keepFocus:v},w,t)},openWithOptions:function(u,w,t){var v=undefined;if(u.pattern){v=l(u.pattern)}o.priv.call("tabs.open",{url:u.url,keepFocus:u.keepFocus,pattern:v},w,t)},closeCurrent:function(t){t=arguments[1]||t;var u=n.tools.UUID();location.hash=u;o.priv.call("tabs.closeCurrent",{hash:u},null,t)}};n.prefs={get:function(u,v,t){o.priv.call("prefs.get",{key:u.toString()},v&&function(w){if(w==="undefined"){w=undefined}else{try{w=JSON.parse(w)}catch(x){t({message:x.toString()});return}}v(w)},t)},set:function(u,v,w,t){if(v===undefined){v="undefined"}else{v=JSON.stringify(v)}o.priv.call("prefs.set",{key:u.toString(),value:v},w,t)},keys:function(u,t){o.priv.call("prefs.keys",{},u,t)},all:function(u,t){var u=u&&function(v){for(key in v){if(v[key]==="undefined"){v[key]=undefined}else{v[key]=JSON.parse(v[key])}}u(v)};o.priv.call("prefs.all",{},u,t)},clear:function(u,v,t){o.priv.call("prefs.clear",{key:u.toString()},v,t)},clearAll:function(u,t){o.priv.call("prefs.clearAll",{},u,t)}};n.file={getImage:function(u,v,t){if(typeof u==="function"){t=v;v=u}o.priv.call("file.getImage",{},v&&function(x){var w={uri:x,name:"Image"};for(prop in u){w[prop]=u[prop]}v(w)},t)},base64:function(u,v,t){o.priv.call("file.base64",u,v,t)},imageBase64:function(v,w,x,u){if(typeof w==="function"){u=x;x=w}var t={};for(prop in v){t[prop]=v[prop]}t.height=w.height||v.height||0;t.width=w.width||v.width||0;o.priv.call("file.base64",t,x,u)},imageURL:function(v,w,x,u){if(typeof w==="function"){u=x;x=w}var t={};for(prop in v){t[prop]=v[prop]}t.height=w.height||v.height||0;t.width=w.width||v.width||0;o.priv.call("file.imageURL",t,x,u)},isImage:function(u,v,t){o.priv.call("file.isImage",u,v,t)},isFile:function(u,v,t){o.priv.call("file.isFile",u,v,t)}};n.event={menuPressed:{addListener:function(u,t){if(o.listeners.menuPressed){o.listeners.menuPressed.push(u)}else{o.listeners.menuPressed=[u]}}},messagePushed:{addListener:function(u,t){if(o.listeners["event.messagePushed"]){o.listeners["event.messagePushed"].push(u)}else{o.listeners["event.messagePushed"]=[u]}}}};n.contact={select:function(u,t){o.priv.call("contact.select",{},u,t)}};n.geolocation={getCurrentPosition:function(u,t){o.priv.call("geolocation.getCurrentPosition",{},u,t)}};var e=[];var k="zero-timeout-message";function c(t){e.push(t);window.postMessage(k,"*");return true}function d(u){if(u.source==window&&u.data==k){u.stopPropagation();if(e.length>0){var t=e.shift();t()}}}window.addEventListener("message",d,true);var p=[];var j;var f=false;o.priv.get=function(){var t=p;p=[];return JSON.stringify(t)};o.priv.send=function(t){p.push(t);if(f&&!j){j=c(function(){window.location.href="forge://go";j=undefined})}};document.addEventListener("DOMContentLoaded",function(){f=true;j=setTimeout(function(){window.location.href="forge://go";j=undefined},0)},false);n.is.mobile=function(){return true};n.is.ios=function(){return true};n.request.ajax=function(J){var v=(J.files?J.files:null);var B=(J.fileUploadMethod?J.fileUploadMethod:"multipart");var w=(J.url?J.url:null);var I=(J.success?J.success:undefined);var D=(J.error?J.error:undefined);var A=(J.username?J.username:null);var H=(J.password?J.password:null);var u=(J.accepts?J.accepts:["*/*"]);var t=(J.cache?J.cache:false);var G=(J.contentType?J.contentType:null);var z=(J.data?J.data:null);var F=(J.dataType?J.dataType:null);var y=(J.headers?J.headers:{});var E=(J.timeout?J.timeout/1000:60);var C=(J.type?J.type:"GET");if(typeof u==="string"){u=[u]}var x=null;if(v){C="POST";if(B=="multipart"){x=n.tools.UUID().replace(/-/g,"");z=o.generateMultipartString(z,x);G="multipart/form-data; boundary="+x}else{if(B=="raw"){if(v.length>1){n.logging.warning("Only one file can be uploaded at once with type 'raw'");v=[v[0]]}z=null;G="image/jpg"}}}else{if(C=="GET"){w=o.generateURI(w,z);z=null}else{if(z){z=o.generateQueryString(z);if(!G){G="application/x-www-form-urlencoded"}}}}if(t){t={};t["wm"+Math.random()]=Math.random();w=o.generateURI(w,t)}if(u){y.Accept=u.join(",")}if(G){y["Content-Type"]=G}o.priv.call("request.ajax",{url:w,username:A,password:H,data:z,headers:y,timeout:E,type:C,boundary:x,files:v,fileUploadMethod:B},I&&function(M){try{if(F=="xml"){var L,K;if(window.DOMParser){L=new DOMParser();K=L.parseFromString(M,"text/xml")}else{K=new ActiveXObject("Microsoft.XMLDOM");K.async="false";K.loadXML(M)}M=K}else{if(F=="json"){M=JSON.parse(M)}}}catch(N){}I(M)},D)};window.forge={config:n.config,is:{mobile:n.is.mobile,desktop:n.is.desktop,android:n.is.android,ios:n.is.ios,chrome:n.is.chrome,firefox:n.is.firefox,safari:n.is.safari,ie:n.is.ie,web:n.is.web},message:{listen:n.message.listen,broadcast:n.message.broadcast,broadcastBackground:n.message.broadcastBackground,toFocussed:n.message.toFocussed},notification:{create:n.notification.create},request:{get:n.request.get,ajax:n.request.ajax},logging:{log:n.logging.log,debug:n.logging.debug,info:n.logging.info,warning:n.logging.warning,error:n.logging.error,critical:n.logging.critical},tabs:{open:n.tabs.open,openWithOptions:n.tabs.openWithOptions,closeCurrent:n.tabs.closeCurrent},tools:{UUID:n.tools.UUID,getURL:n.tools.getURL},prefs:{get:n.prefs.get,set:n.prefs.set,clear:n.prefs.clear,clearAll:n.prefs.clearAll,keys:n.prefs.keys},button:{setIcon:n.button.setIcon,setURL:n.button.setURL,onClicked:{addListener:n.button.onClicked.addListener},setBadge:n.button.setBadge,setBadgeBackgroundColor:n.button.setBadgeBackgroundColor,setTitle:n.button.setTitle},file:{getImage:n.file.getImage,isFile:n.file.isFile,isImage:n.file.isImage,imageURL:n.file.imageURL,imageBase64:n.file.imageBase64,base64:n.file.base64},event:{menuPressed:{addListener:n.event.menuPressed.addListener},messagePushed:{addListener:n.event.messagePushed.addListener}},contact:{select:n.contact.select},geolocation:{getCurrentPosition:n.geolocation.getCurrentPosition}};window.forge["ajax"]=n.request.ajax;window.forge["getPage"]=n.request.get;window.forge["createNotification"]=n.notification.create;window.forge["UUID"]=n.tools.UUID;window.forge["getURL"]=n.tools.getURL;window.forge["log"]=n.logging.log;window.forge["button"]["setUrl"]=n.button.setURL;window.forge["button"]["setBadgeText"]=n.button.setBadge;window.forge["_get"]=o.priv.get;window.forge["_receive"]=o.priv.receive;window.forge["_dispatchMessage"]=o.dispatchMessage})();